<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Battleship War: Tactical Command</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        body { background: #020617; color: #22c55e; font-family: 'Courier New', monospace; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .hud { width: 1100px; margin: 20px; padding: 20px; background: #0f172a; border: 3px solid #1e293b; border-radius: 10px; }
        
        .main-layout { display: flex; justify-content: space-between; gap: 10px; }
        
        /* Grids */
        .grid-container { display: flex; flex-direction: column; align-items: center; }
        .grid { display: grid; grid-template-columns: 30px repeat(12, 32px); gap: 1px; background: #1e293b; border: 1px solid #334155; }
        .cell { width: 32px; height: 32px; background: #020617; border: 1px solid #0f172a; cursor: pointer; position: relative; display: flex; align-items: center; justify-content: center; }
        .label { background: #0f172a; color: #64748b; font-weight: bold; cursor: default; font-size: 10px; }
        
        /* Ship Visuals */
        .ship-part { background: #475569; border: 1px solid #94a3b8; z-index: 5; }
        .hit { background: #ef4444 !important; color: white; animation: shake 0.3s; z-index: 10; }
        .miss { background: #38bdf8 !important; opacity: 0.3; }
        
        /* Side Panels */
        .side-panel { width: 180px; background: rgba(0,0,0,0.3); padding: 10px; border: 1px solid #334155; }
        .ship-card { margin: 10px 0; padding: 5px; border-bottom: 1px solid #1e293b; font-size: 11px; position: relative; }
        .sunk-text { color: #ef4444; font-weight: bold; text-transform: uppercase; }
        .health-bar { height: 4px; background: #22c55e; margin-top: 4px; transition: 0.3s; }

        /* Big Explosion Effect */
        .explosion { position: absolute; width: 60px; height: 60px; background: radial-gradient(circle, #fb923c, #ef4444, transparent); border-radius: 50%; animation: boom 0.6s ease-out forwards; pointer-events: none; z-index: 100; }
        
        #controls { margin-top: 20px; display: flex; gap: 15px; justify-content: center; }
        .btn { background: #22c55e; color: #000; border: none; padding: 12px 20px; font-weight: bold; cursor: pointer; border-radius: 5px; }
        .btn-rotate { background: #f59e0b; }

        @keyframes boom { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(3); opacity: 0; } }
        @keyframes shake { 0% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -2px); } 100% { transform: translate(0,0); } }
    </style>
</head>
<body>

<div class="hud">
    <h1 style="text-align: center; margin: 0; letter-spacing: 5px;">TACTICAL COMMAND CENTER</h1>
    <div id="status" style="background: #000; border: 1px solid #22c55e; padding: 10px; margin: 15px 0; text-align: center;">PHASE 1: PLACE YOUR 4x2 CARRIER</div>

    <div class="main-layout">
        <div class="side-panel">
            <h3 style="font-size: 14px; border-bottom: 2px solid #22c55e;">YOUR FLEET</h3>
            <div id="p-list"></div>
        </div>

        <div class="grid-container">
            <div id="p-grid" class="grid"></div>
            <p style="font-size: 12px;">STRATEGY PANEL (A1-L12)</p>
        </div>

        <div class="grid-container">
            <div id="e-grid" class="grid"></div>
            <p style="font-size: 12px;">ENEMY RADAR</p>
        </div>

        <div class="side-panel">
            <h3 style="font-size: 14px; border-bottom: 2px solid #ef4444; color: #ef4444;">ENEMY FLEET</h3>
            <div id="e-list"></div>
        </div>
    </div>

    <div id="controls">
        <button id="rot-btn" class="btn btn-rotate">ROTATE SHIP (HORIZONTAL)</button>
        <button class="btn" onclick="location.reload()">RESTART MISSION</button>
    </div>
</div>

<script type="py">
import random
from pyscript import document, window

# 1. Config
SHIP_DATA = [
    {"name": "CARRIER", "size": (4, 2)},
    {"name": "DREADNOUGHT", "size": (6, 1)},
    {"name": "SUBMARINE", "size": (3, 1)},
    {"name": "FRIGATE", "size": (5, 1)},
    {"name": "DESTROYER", "size": (5, 1)}
]
SIZE = 12
p_fleet = []
e_fleet = []
current_idx = 0
horiz = True
phase = "SETUP"

def init():
    for g_id in ["p-grid", "e-grid"]:
        grid = document.getElementById(g_id)
        grid.appendChild(create_cell("", "label"))
        for i in range(1, SIZE+1): grid.appendChild(create_cell(str(i), "label"))
        for r in range(SIZE):
            grid.appendChild(create_cell(chr(65+r), "label"))
            for c in range(SIZE):
                cell = create_cell("", "cell")
                cell.id = f"{g_id[0]}-{r}-{c}"
                if g_id == "p-grid": cell.onclick = lambda e, r=r, c=c: place(r, c)
                else: cell.onclick = lambda e, r=r, c=c: attack(r, c)
                grid.appendChild(cell)
    update_lists()
    setup_cpu()

def create_cell(t, cls):
    c = document.createElement("div")
    c.className = f"cell {cls}"
    c.innerText = t
    return c

def place(r, c):
    global current_idx, phase
    if phase != "SETUP": return
    ship = SHIP_DATA[current_idx]
    w, h = (ship["size"][0], ship["size"][1]) if horiz else (ship["size"][1], ship["size"][0])
    
    if r+h <= SIZE and c+w <= SIZE:
        coords = set((r+i, c+j) for i in range(h) for j in range(w))
        if any(coords & s["coords"] for s in p_fleet): return
        
        for pr, pc in coords:
            document.getElementById(f"p-{pr}-{pc}").classList.add("ship-part")
        
        p_fleet.append({"name": ship["name"], "coords": coords, "hp": len(coords), "max": len(coords)})
        current_idx += 1
        if current_idx < len(SHIP_DATA):
            document.getElementById("status").innerText = f"PLACE {SHIP_DATA[current_idx]['name']}"
        else:
            phase = "BATTLE"
            document.getElementById("status").innerText = "BATTLE STATIONS! ATTACK THE ENEMY RADAR."
        update_lists()

def setup_cpu():
    for ship in SHIP_DATA:
        placed = False
        while not placed:
            r, c, rot = random.randint(0,11), random.randint(0,11), random.choice([True, False])
            w, h = (ship["size"][0], ship["size"][1]) if rot else (ship["size"][1], ship["size"][0])
            if r+h <= SIZE and c+w <= SIZE:
                coords = set((r+i, c+j) for i in range(h) for j in range(w))
                if not any(coords & s["coords"] for s in e_fleet):
                    e_fleet.append({"name": ship["name"], "coords": coords, "hp": len(coords), "max": len(coords)})
                    placed = True

def attack(r, c):
    if phase != "BATTLE": return
    cell = document.getElementById(f"e-{r}-{c}")
    if "hit" in cell.className or "miss" in cell.className: return
    
    hit = False
    for s in e_fleet:
        if (r, c) in s["coords"]:
            cell.classList.add("hit")
            cell.innerText = "X"
            s["hp"] -= 1
            hit = True
            if s["hp"] == 0: trigger_explosion(cell, s["name"], "ENEMY")
            break
    if not hit:
        cell.classList.add("miss")
        cpu_turn()
    update_lists()

def cpu_turn():
    r, c = random.randint(0,11), random.randint(0,11)
    cell = document.getElementById(f"p-{r}-{c}")
    for s in p_fleet:
        if (r, c) in s["coords"]:
            cell.classList.add("hit")
            s["hp"] -= 1
            if s["hp"] == 0: trigger_explosion(cell, s["name"], "YOUR")
            return
    cell.classList.add("miss")

def trigger_explosion(el, name, fleet):
    boom = document.createElement("div")
    boom.className = "explosion"
    el.appendChild(boom)
    document.getElementById("status").innerText = f"BIG EXPLOSION! {fleet} {name} WAS SUNK!"

def update_lists():
    for side in ["p", "e"]:
        cont = document.getElementById(f"{side}-list")
        cont.innerHTML = ""
        fleet = p_fleet if side == "p" else e_fleet
        for s in fleet:
            card = document.createElement("div")
            card.className = "ship-card"
            if s["hp"] <= 0: card.innerHTML = f"<span class='sunk'>{s['name']} - SUNK</span>"
            else: card.innerHTML = f"<span>{s['name']}</span><div class='health-bar' style='width:{(s['hp']/s['max'])*100}%'></div>"
            cont.appendChild(card)

def toggle_rot(e):
    global horiz
    horiz = not horiz
    document.getElementById("rot-btn").innerText = f"ROTATE SHIP ({'HORIZONTAL' if horiz else 'VERTICAL'})"

init()
document.getElementById("rot-btn").onclick = toggle_rot
</script>
</body>
</html>
