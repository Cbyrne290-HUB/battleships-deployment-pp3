<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Battleship War: Strategy Panel</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        :root { --neon: #22c55e; --bg: #020617; --steel: #1e293b; --danger: #ef4444; }
        body { background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; margin: 0; display: flex; flex-direction: column; align-items: center; }
        
        .monitor-frame { 
            width: 1150px; margin: 20px; padding: 20px; 
            background: #0f172a; border: 8px solid var(--steel); 
            border-radius: 20px; box-shadow: inset 0 0 50px #000, 0 0 30px rgba(0,0,0,0.8);
        }

        .layout { display: flex; justify-content: space-between; gap: 20px; }

        /* Ship Hangar & Visuals */
        .hangar { width: 230px; padding: 10px; border-right: 2px solid var(--steel); }
        .ship-vessel { 
            background: #475569; border: 2px solid var(--neon); margin: 10px 0;
            cursor: grab; position: relative; display: flex; align-items: center; 
            justify-content: center; transition: 0.3s; font-weight: bold; font-size: 10px;
        }
        .ship-vessel:hover { background: var(--neon); color: black; }
        .vertical { transform: rotate(90deg); margin: 40px 0; }

        /* Specific Vessel Shapes */
        #s0 { width: 120px; height: 40px; clip-path: polygon(0% 20%, 100% 0%, 100% 100%, 0% 80%); } /* Carrier */
        #s1 { width: 180px; height: 30px; border-radius: 50px 10px 10px 50px; } /* Dreadnought */
        #s2 { width: 90px; height: 25px; border-radius: 20px; } /* Sub */
        #s3, #s4 { width: 150px; height: 30px; clip-path: polygon(15% 0, 100% 0, 85% 100%, 0 100%); } /* Battleships */

        /* Closed Grid Styling */
        .grid-wrapper { border: 4px solid var(--steel); background: var(--steel); padding: 2px; }
        .grid { display: grid; grid-template-columns: 35px repeat(12, 35px); gap: 1px; }
        .cell { width: 35px; height: 35px; background: var(--bg); position: relative; }
        .label { background: #0f172a; color: var(--neon); font-size: 11px; display: flex; align-items: center; justify-content: center; font-weight: bold; }

        /* Effects */
        .placed { background: #1e293b !important; border: 1px solid var(--neon); box-shadow: inset 0 0 10px var(--neon); }
        .hit { background: var(--danger) !important; animation: explode 0.5s ease-out; }
        .miss { background: #0ea5e9 !important; opacity: 0.4; }
        .sunk-ship { filter: grayscale(1) brightness(0.5); border-color: var(--danger) !important; }
        
        @keyframes explode {
            0% { transform: scale(1); background: white; }
            50% { transform: scale(1.5); background: orange; }
            100% { transform: scale(1); background: var(--danger); }
        }

        .btn { background: var(--neon); color: #000; border: none; padding: 10px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .rotate-hint { font-size: 9px; color: #fb923c; margin-top: 2px; }
    </style>
</head>
<body>

<div class="monitor-frame">
    <h1 style="text-align: center; margin: 0 0 15px 0; letter-spacing: 4px;">STRATEGY PANEL: BATTLE READY</h1>
    
    <div class="layout">
        <div class="hangar">
            <p style="font-size: 11px;">DRAG TO GRID | RIGHT-CLICK TO ROTATE</p>
            <div class="ship-vessel" draggable="true" id="s0" oncontextmenu="rotate_me(event, 0)">CARRIER</div>
            <div class="ship-vessel" draggable="true" id="s1" oncontextmenu="rotate_me(event, 1)">DREADNOUGHT</div>
            <div class="ship-vessel" draggable="true" id="s2" oncontextmenu="rotate_me(event, 2)">SUBMARINE</div>
            <div class="ship-vessel" draggable="true" id="s3" oncontextmenu="rotate_me(event, 3)">BATTLESHIP A</div>
            <div class="ship-vessel" draggable="true" id="s4" oncontextmenu="rotate_me(event, 4)">BATTLESHIP B</div>
            
            <div id="fleet-comms" style="margin-top:20px; font-size: 12px; border: 1px solid var(--steel); padding: 5px;">
                STATUS: WAITING FOR DEPLOYMENT...
            </div>
        </div>

        <div class="grid-wrapper">
            <div id="p-grid" class="grid"></div>
            <div style="background: var(--steel); text-align: center; font-size: 10px; padding: 5px;">TACTICAL STRATEGY GRID</div>
        </div>

        <div id="enemy-radar" class="grid-wrapper" style="opacity: 0.1; pointer-events: none;">
            <div id="e-grid" class="grid"></div>
            <div style="background: var(--steel); text-align: center; font-size: 10px; padding: 5px;">ENEMY RADAR ZONE</div>
        </div>
    </div>
</div>

<script type="py">
from pyscript import document, window
import random

FLEET_DATA = [
    {"id": 0, "name": "CARRIER", "size": (4, 2)},
    {"id": 1, "name": "DREADNOUGHT", "size": (6, 1)},
    {"id": 2, "name": "SUBMARINE", "size": (3, 1)},
    {"id": 3, "name": "BATTLESHIP A", "size": (5, 1)},
    {"id": 4, "name": "BATTLESHIP B", "size": (5, 1)}
]

SIZE = 12
player_ships, enemy_ships = [], []
ship_rotations = [True, True, True, True, True] # True = Horizontal

def init_boards():
    for g_id in ["p-grid", "e-grid"]:
        grid = document.getElementById(g_id)
        grid.appendChild(create_sq("", "label"))
        for i in range(1, SIZE+1): grid.appendChild(create_sq(str(i), "label"))
        for r in range(SIZE):
            grid.appendChild(create_sq(chr(65+r), "label"))
            for c in range(SIZE):
                sq = create_sq("", "cell")
                sq.id = f"{g_id[0]}-{r}-{c}"
                if g_id == "p-grid":
                    sq.ondragover = lambda e: e.preventDefault()
                    sq.ondrop = lambda e, row=r, col=c: drop_ship(e, row, col)
                else:
                    sq.onclick = lambda e, row=r, col=c: attack_enemy(row, col)
                grid.appendChild(sq)
    setup_cpu()

def create_sq(t, cls):
    d = document.createElement("div")
    d.className = f"cell {cls}"
    d.innerText = t
    return d

def drop_ship(event, r, c):
    s_id = int(event.dataTransfer.getData("text"))
    spec = FLEET_DATA[s_id]
    is_h = ship_rotations[s_id]
    w, h = spec["size"] if is_h else (spec["size"][1], spec["size"][0])
    
    if r + h <= SIZE and c + w <= SIZE:
        coords = set((r+i, c+j) for i in range(h) for j in range(w))
        if any(coords & s["coords"] for s in player_ships): return
        
        for pr, pc in coords:
            document.getElementById(f"p-{pr}-{pc}").classList.add("placed")
        
        player_ships.append({"name": spec["name"], "coords": coords, "hp": len(coords)})
        document.getElementById(f"s{s_id}").style.visibility = "hidden"
        
        if len(player_fleet_check()) == 5:
            document.getElementById("enemy-radar").style.opacity = "1"
            document.getElementById("enemy-radar").style.pointerEvents = "all"
            document.getElementById("fleet-comms").innerText = "STATUS: ENGAGING ENEMY"

def player_fleet_check(): return player_ships

def setup_cpu():
    for spec in FLEET_DATA:
        placed = False
        while not placed:
            r, c, h_mode = random.randint(0,11), random.randint(0,11), random.choice([True, False])
            w, h = spec["size"] if h_mode else (spec["size"][1], spec["size"][0])
            if r+h <= SIZE and c+w <= SIZE:
                coords = set((r+i, c+j) for i in range(h) for j in range(w))
                if not any(coords & s["coords"] for s in enemy_ships):
                    enemy_ships.append({"name": spec["name"], "coords": coords, "hp": len(coords)})
                    placed = True

def attack_enemy(r, c):
    cell = document.getElementById(f"e-{r}-{c}")
    if "hit" in cell.className or "miss" in cell.className: return
    
    hit = False
    for s in enemy_ships:
        if (r, c) in s["coords"]:
            cell.classList.add("hit")
            s["hp"] -= 1
            hit = True
            if s["hp"] == 0:
                document.getElementById("fleet-comms").innerText = f"SYSTEM: ENEMY {s['name']} SUNK!"
            break
    if not hit: cell.classList.add("miss")
    window.setTimeout(lambda: cpu_turn(), 300)

def cpu_turn():
    r, c = random.randint(0, 11), random.randint(0, 11)
    cell = document.getElementById(f"p-{r}-{c}")
    if "hit" in cell.className or "miss" in cell.className: return
    hit = False
    for s in player_ships:
        if (r, c) in s["coords"]:
            cell.classList.add("hit")
            hit = True; break
    if not hit: cell.classList.add("miss")

def rotate_me(event, s_id):
    event.preventDefault()
    ship_rotations[s_id] = not ship_rotations[s_id]
    el = document.getElementById(f"s{s_id}")
    if not ship_rotations[s_id]: el.classList.add("vertical")
    else: el.classList.remove("vertical")

def start_drag(event):
    event.dataTransfer.setData("text", event.target.id[1:])

window.start_drag = start_drag
window.rotate_me = rotate_me
for i in range(5):
    document.getElementById(f"s{i}").ondragstart = start_drag

init_boards()
</script>
</body>
</html>
