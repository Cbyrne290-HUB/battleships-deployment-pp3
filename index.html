<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Battleship War: Strategy Panel</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        body { background: #020617; color: #22c55e; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; margin: 0; overflow-x: hidden; }
        .strategy-container { width: 1100px; background: #0f172a; border: 4px solid #1e293b; padding: 20px; margin-top: 20px; box-shadow: 0 0 50px #000; border-radius: 10px; position: relative; }
        
        .layout { display: flex; justify-content: space-around; align-items: flex-start; margin-top: 20px; }
        
        /* Ship Dock (Left Side) */
        .ship-dock { width: 200px; display: flex; flex-direction: column; gap: 15px; border-right: 1px solid #334155; padding-right: 20px; }
        .dock-item { padding: 10px; border: 1px dashed #475569; opacity: 0.6; text-align: center; font-size: 12px; }
        .dock-active { border: 2px solid #22c55e; opacity: 1; background: rgba(34, 197, 94, 0.1); }

        /* The Grid */
        .grid-frame { display: flex; flex-direction: column; align-items: center; }
        .grid { display: grid; grid-template-columns: 35px repeat(12, 40px); gap: 1px; background: #22c55e; border: 2px solid #22c55e; box-shadow: 0 0 15px rgba(34, 197, 94, 0.3); }
        .cell { width: 40px; height: 40px; background: #020617; display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; }
        .cell:hover { background: #1e293b; }
        .label { background: #0f172a; color: #22c55e; font-weight: bold; cursor: default; }

        /* Ship Graphics */
        .ship-overlay { position: absolute; background-size: contain; background-repeat: no-repeat; background-position: center; pointer-events: none; z-index: 10; filter: drop-shadow(0 0 5px #000); }
        .sunk-text { position: absolute; color: #ef4444; font-weight: bold; font-size: 20px; transform: rotate(-30deg); z-index: 100; text-shadow: 2px 2px #000; pointer-events: none; }

        /* Controls (Right Side) */
        .side-menu { width: 180px; display: flex; flex-direction: column; gap: 20px; }
        .control-btn { width: 60px; height: 60px; background: #000; border: 2px solid #22c55e; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .control-btn:hover { background: #22c55e; color: #000; }
        .play-btn { width: 80px; height: 80px; border-radius: 50%; background: #059669; color: white; font-size: 30px; display: none; }

        .explosion { position: absolute; width: 100%; height: 100%; background: radial-gradient(circle, #fb923c, #ef4444, transparent); animation: boom 0.6s ease-out forwards; z-index: 50; }
        @keyframes boom { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(3); opacity: 0; } }
    </style>
</head>
<body>

<div class="strategy-container">
    <h1 style="text-align: center; margin: 0; letter-spacing: 5px;">STRATEGY PANEL</h1>
    <div id="msg" style="text-align: center; padding: 10px; color: #fb923c;">CLICK GRID TO PLACE CARRIER (4x2)</div>

    <div class="layout">
        <div class="ship-dock" id="fleet-list">
            <div id="d0" class="dock-item dock-active">CARRIER (4x2)</div>
            <div id="d1" class="dock-item">DREADNOUGHT (6x1)</div>
            <div id="d2" class="dock-item">SUBMARINE (3x1)</div>
            <div id="d3" class="dock-item">FRIGATE (5x1)</div>
            <div id="d4" class="dock-item">DESTROYER (5x1)</div>
        </div>

        <div class="grid-frame">
            <div id="main-grid" class="grid"></div>
            <p id="coords-display">TARGET COORDS: --</p>
        </div>

        <div class="side-menu">
            <div class="control-btn" onclick="rotateShip()" title="Rotate">üîÑ</div>
            <div class="control-btn" onclick="location.reload()" title="Clear">üóëÔ∏è</div>
            <button id="start-btn" class="control-btn play-btn" onclick="startGame()">‚ñ∂</button>
        </div>
    </div>
</div>

<script type="py">
from pyscript import document, window
import random

# Ship Configuration
FLEET_DATA = [
    {"name": "CARRIER", "size": (4, 2), "img": "https://img.icons8.com/color/96/aircraft-carrier.png"},
    {"name": "DREADNOUGHT", "size": (6, 1), "img": "https://img.icons8.com/color/96/battleship.png"},
    {"name": "SUBMARINE", "size": (3, 1), "img": "https://img.icons8.com/color/96/submarine.png"},
    {"name": "FRIGATE", "size": (5, 1), "img": "https://img.icons8.com/color/96/frigate.png"},
    {"name": "DESTROYER", "size": (5, 1), "img": "https://img.icons8.com/color/96/warship.png"}
]

GRID_SIZE = 12
player_ships = []
current_ship_idx = 0
is_horiz = True
game_mode = "PLACEMENT"

def init_grid():
    grid = document.getElementById("main-grid")
    # Corner label
    grid.appendChild(create_cell("", "label"))
    # Top labels 1-12
    for i in range(1, GRID_SIZE+1): grid.appendChild(create_cell(str(i), "label"))
    
    for r in range(GRID_SIZE):
        grid.appendChild(create_cell(chr(65+r), "label"))
        for c in range(GRID_SIZE):
            cell = create_cell("", "cell")
            cell.id = f"cell-{r}-{c}"
            cell.onmouseenter = lambda e, row=r, col=c: show_preview(row, col)
            cell.onclick = lambda e, row=r, col=c: place_ship(row, col)
            grid.appendChild(cell)

def create_cell(text, cls):
    d = document.createElement("div")
    d.className = cls
    d.innerText = text
    return d

def rotateShip(event=None):
    global is_horiz
    is_horiz = not is_horiz
    status = "HORIZONTAL" if is_horiz else "VERTICAL"
    document.getElementById("msg").innerText = f"ROTATION: {status} - PLACE {FLEET_DATA[current_ship_idx]['name']}"

window.rotateShip = rotateShip

def place_ship(r, c):
    global current_ship_idx, game_mode
    if game_mode != "PLACEMENT": return
    
    ship = FLEET_DATA[current_ship_idx]
    w, h = (ship["size"][0], ship["size"][1]) if is_horiz else (ship["size"][1], ship["size"][0])
    
    if r + h <= GRID_SIZE and c + w <= GRID_SIZE:
        coords = set((r+i, c+j) for i in range(h) for j in range(w))
        # Check for overlap
        if any(coords & s["coords"] for s in player_ships): return
        
        # Add ship to player fleet
        player_ships.append({"name": ship["name"], "coords": coords, "hp": len(coords)})
        
        # Visual placement (Add the image)
        origin_cell = document.getElementById(f"cell-{r}-{c}")
        img = document.createElement("div")
        img.className = "ship-overlay"
        img.style.backgroundImage = f"url('{ship['img']}')"
        img.style.width = f"{w * 40}px"
        img.style.height = f"{h * 40}px"
        if not is_horiz: img.style.transform = "rotate(90deg)"
        origin_cell.appendChild(img)
        
        # Update UI
        document.getElementById(f"d{current_ship_idx}").className = "dock-item"
        current_ship_idx += 1
        
        if current_ship_idx < len(FLEET_DATA):
            document.getElementById(f"d{current_ship_idx}").className = "dock-item dock-active"
            rotateShip() # Reset message
        else:
            game_mode = "READY"
            document.getElementById("msg").innerText = "FLEET DEPLOYED. PRESS START."
            document.getElementById("start-btn").style.display = "flex"

def startGame(event=None):
    document.getElementById("msg").innerText = "BATTLE COMMENCED! ENEMY FLEET DETECTED."
    document.getElementById("start-btn").style.display = "none"
    # Logic for switching to battle grid would go here

window.startGame = startGame

init_grid()
</script>
</body>
</html>
