<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Tactical Command: Strategy Panel</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        body { background: #020617; color: #22c55e; font-family: 'Courier New', monospace; text-align: center; }
        .hud-container { width: 1000px; margin: 20px auto; border: 2px solid #1e293b; background: #0f172a; padding: 20px; box-shadow: 0 0 20px #000; }
        .grid-container { display: flex; justify-content: center; gap: 40px; margin-top: 20px; }
        .grid { display: grid; grid-template-columns: 30px repeat(12, 35px); gap: 1px; background: #1e293b; border: 1px solid #334155; }
        .cell { width: 35px; height: 35px; background: #020617; border: 1px solid #1e293b; display: flex; align-items: center; justify-content: center; font-size: 10px; cursor: pointer; }
        .label { background: #0f172a; color: #64748b; font-weight: bold; cursor: default; }
        .ship-block { background: #475569; border: 1px solid #94a3b8; box-shadow: inset 0 0 8px #000; }
        .hit { background: #ef4444 !important; color: white; }
        .miss { background: #38bdf8 !important; opacity: 0.5; }
        .status-box { background: #000; border: 1px solid #22c55e; padding: 15px; margin-bottom: 20px; font-weight: bold; }
        .health-bar { width: 100%; height: 10px; background: #334155; margin: 5px 0; }
        .health-fill { height: 100%; background: #22c55e; transition: width 0.3s; }
    </style>
</head>
<body>
    <div class="hud-container">
        <div class="status-box" id="status-panel">COMMANDER: PLACE 4x2 CARRIER. PRESS 'R' TO ROTATE SHIP.</div>
        
        <div class="grid-container">
            <div>
                <p>YOUR STRATEGY PANEL</p>
                <div class="health-bar"><div id="p-hp" class="health-fill" style="width: 100%;"></div></div>
                <div id="player-grid" class="grid"></div>
            </div>
            <div>
                <p>ENEMY TACTICAL GRID</p>
                <div class="health-bar"><div id="e-hp" class="health-fill" style="width: 100%;"></div></div>
                <div id="enemy-grid" class="grid"></div>
            </div>
        </div>
    </div>

    <script type="py">
import random
from pyscript import document, window

# Ship sizes per your request
FLEET = [(4,2), (6,1), (3,1), (5,1), (5,1)]
SIZE = 12
p_fleet = set()
e_fleet = set()
current_idx = 0
horiz = True
phase = "SETUP"

def build_grids():
    for grid_id in ["player-grid", "enemy-grid"]:
        el = document.getElementById(grid_id)
        # Header Row (1-12)
        el.appendChild(create_cell("", "label"))
        for i in range(1, SIZE+1): el.appendChild(create_cell(str(i), "label"))
        
        for r in range(SIZE):
            # Row Label (A-L)
            el.appendChild(create_cell(chr(65+r), "label"))
            for c in range(SIZE):
                cell = create_cell("", "cell")
                cell.id = f"{grid_id[0]}-{r}-{c}"
                if grid_id.startswith("p"):
                    cell.onclick = lambda e, row=r, col=c: place_ship(row, col)
                else:
                    cell.onclick = lambda e, row=r, col=c: attack(row, col)
                el.appendChild(cell)

    # Randomly place CPU fleet
    total_parts = 0
    for ship in FLEET:
        total_parts += ship[0] * ship[1]
        placed = False
        while not placed:
            r, c = random.randint(0,11), random.randint(0,11)
            h_rot = random.choice([True, False])
            w, h = (ship[0], ship[1]) if h_rot else (ship[1], ship[0])
            if r+h <= SIZE and c+w <= SIZE:
                coords = set((r+i, c+j) for i in range(h) for j in range(w))
                if not (coords & e_fleet):
                    e_fleet.update(coords)
                    placed = True
    return total_parts

def create_cell(txt, cls):
    c = document.createElement("div")
    c.className = cls
    c.innerText = txt
    return c

def place_ship(r, c):
    global current_idx, phase
    if phase != "SETUP": return
    ship = FLEET[current_idx]
    w, h = (ship[0], ship[1]) if horiz else (ship[1], ship[0])
    
    if r+h <= SIZE and c+w <= SIZE:
        new_coords = set((r+i, c+j) for i in range(h) for j in range(w))
        if not (new_coords & p_fleet):
            for pr, pc in new_coords:
                document.getElementById(f"p-{pr}-{pc}").classList.add("ship-block")
            p_fleet.update(new_coords)
            current_idx += 1
            if current_idx < len(FLEET):
                nxt = FLEET[current_idx]
                document.getElementById("status-panel").innerText = f"PLACE {nxt[0]}x{nxt[1]} SHIP. PRESS 'R' TO ROTATE."
            else:
                phase = "BATTLE"
                document.getElementById("status-panel").innerText = "FLEET DEPLOYED. COMMENCE ATTACK ON ENEMY GRID."

def attack(r, c):
    global e_fleet
    if phase != "BATTLE": return
    cell = document.getElementById(f"e-{r}-{c}")
    if cell.classList.contains("hit") or cell.classList.contains("miss"): return
    
    if (r, c) in e_fleet:
        cell.classList.add("hit")
        cell.innerText = "X"
        e_fleet.remove((r, c))
        update_hp()
        if not e_fleet: document.getElementById("status-panel").innerText = "VICTORY: ENEMY SUNK!"
    else:
        cell.classList.add("miss")
        cpu_turn()

def cpu_turn():
    r, c = random.randint(0,11), random.randint(0,11)
    cell = document.getElementById(f"p-{r}-{c}")
    if (r, c) in p_fleet:
        cell.classList.add("hit")
        p_fleet.remove((r,c))
        update_hp()
    else:
        cell.classList.add("miss")

def update_hp():
    p_pct = (len(p_fleet) / TOTAL_P) * 100
    e_pct = (len(e_fleet) / TOTAL_P) * 100
    document.getElementById("p-hp").style.width = f"{p_pct}%"
    document.getElementById("e-hp").style.width = f"{e_pct}%"

def rotate(e):
    global horiz
    if e.key.lower() == 'r': 
        horiz = not horiz
        document.getElementById("status-panel").innerText += " (ROTATED)"

TOTAL_P = build_grids()
window.addEventListener("keydown", rotate)
    </script>
</body>
</html>
